Metadata-Version: 2.4
Name: me-engineering-assistant
Version: 0.1.0
Summary: ME Engineering Assistant â€“ multi-source RAG agent for ECU docs
Author: Quincey
Requires-Python: >=3.10
Description-Content-Type: text/markdown
Requires-Dist: langchain
Requires-Dist: langgraph
Requires-Dist: langchain-community
Requires-Dist: langchain-text-splitters
Requires-Dist: sentence-transformers
Requires-Dist: chromadb
Requires-Dist: fastapi
Requires-Dist: uvicorn[standard]
Requires-Dist: mlflow
Requires-Dist: pydantic
Requires-Dist: pytest
Requires-Dist: pylint
Requires-Dist: transformers
Requires-Dist: accelerate
Requires-Dist: sentencepiece
Provides-Extra: dev
Requires-Dist: pytest; extra == "dev"
Requires-Dist: pylint; extra == "dev"

# ME Engineering Assistant

A production-ready Retrieval-Augmented Generation (RAG) system designed to answer engineering questions based on ECU (Electronic Control Unit) technical manuals.  
The system supports:

- Local LLM inference (Phi-3 Mini)
- RAG with manual embeddings
- Question routing across multiple ECU models
- End-to-end FastAPI REST service
- MLflow model packaging + production loading
- Docker deployment

---

## ğŸš€ Features

### âœ” Multi-Manual RAG
Loads ECU-700, ECU-800 Base, and ECU-800 Plus manuals and automatically routes questions to the correct documents.

### âœ” Local Phi-3 LLM Inference
Runs fully offline using Microsoft's `Phi-3-mini-4k-instruct` model on CPU or MPS (Apple Silicon).

### âœ” Embedding-based Vector Search  
Uses sentence-transformer embeddings to retrieve high-relevance technical passages.

### âœ” Router Model
Classifies questions into `ECU-800-base`, `ECU-800-plus`, or fallback categories.

### âœ” MLflow Model Packaging
Exports the entire RAG pipeline as a reproducible MLflow model for production deployment.

### âœ” FastAPI Web Server
Provides a `/predict` endpoint for integration with external applications or Postman.

---

## 1. Architecture Overview

```text
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ Question (User Input) â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Router Model      â”‚
                    â”‚ (LangChain)       â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Select relevant ECU manual               â”‚
        â”‚ ECU-700 / ECU-800 Base / ECU-800 Plus   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â–¼
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚ Vectorstore       â”‚
                 â”‚ (Embeddings + FA) â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â–¼
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚ Local LLM (Phi-3) â”‚
                 â”‚ Generate Answer   â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â–¼
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚ Final Response     â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. Repository Structure

```text
me-engineering-assistant/
â”‚
â”œâ”€â”€ README.md
â”œâ”€â”€ pyproject.toml
â”‚
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ ECU-700_Series_Manual.md
â”‚   â”œâ”€â”€ ECU-800_Series_Base.md
â”‚   â”œâ”€â”€ ECU-800_Series_Plus.md
â”‚   â””â”€â”€ test-questions.csv
â”‚
â”œâ”€â”€ mlruns/                   # MLflow local model registry
â”‚
â”œâ”€â”€ src/
â”‚   â””â”€â”€ me_engineering_assistant/
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ __main__.py       # FastAPI entrypoint
â”‚       â”œâ”€â”€ api.py            # REST API logic
â”‚       â”œâ”€â”€ config.py
â”‚       â”œâ”€â”€ data_loader.py
â”‚       â”œâ”€â”€ graph.py          # LangGraph orchestration
â”‚       â”œâ”€â”€ log_model.py      # MLflow model export
â”‚       â”œâ”€â”€ mlflow_model.py   # Inference wrapper for MLflow
â”‚       â”œâ”€â”€ rag_chain.py      # RAG logic
â”‚       â”œâ”€â”€ router.py         # Question routing
â”‚       â”œâ”€â”€ sandbox_test.py   # Local debugging CLI
â”‚       â”œâ”€â”€ vectorstore.py    # Embeddings + vector DB
â”‚
â”œâ”€â”€ tests/
â”‚   â””â”€â”€ test_agent_e2e.py
```

---

## 3. Architecture Overview

### 3.1 System Components

| Component         | Description                                                |
|-------------------|------------------------------------------------------------|
| `router.py`       | Routes questions to the correct manual set using LangGraph |
| `vectorstore.py`  | Builds FAISS index + HuggingFace embeddings                |
| `rag_chain.py`    | Retrieval-Augmented Generation pipeline                    |
| `graph.py`        | LangGraph workflow orchestrating router + RAG              |
| `api.py`          | FastAPI server exposing `/predict`                         |
| `mlflow_model.py` | MLflow pyfunc wrapper with predict()                       |
| `log_model.py`    | Logs the agent as an MLflow model                          |
| `sandbox_test.py` | Command-line testing script                                |

---

## 4. Installation

### 4.1 Clone the repository

```bash
git clone <repo-url>
cd me-engineering-assistant
```

### 4.2 Create a Python 3.11 virtual environment

```bash
python3.11 -m venv .venv
source .venv/bin/activate
```

### 4.3 Install dependencies

```bash
pip install .
```

For development mode:
```bash
pip install -e .
```

---

## 5. Running the Agent Locally (CLI Test)

```bash
python -m me_engineering_assistant.sandbox_test
```
Example output:
```vbnet
Question: What is the maximum operating temperature for the ECU-850b?
Answer: The maximum operating temperature for the ECU-850b is +105Â°C.
```

---

## 6. Start the FastAPI Server

```bash
python -m me_engineering_assistant
```
The server will start at:
```bash
http://localhost:8000/predict
```

---

## 7. Example API Usage

### 7.1 cURL

```bash
curl -X POST http://localhost:8000/predict \
     -H "Content-Type: application/json" \
     -d '{"questions": ["What is the maximum operating temperature of the ECU-850b?"]}'
```

### 7.2 Python

```bash
import requests

resp = requests.post(
    "http://localhost:8000/predict",
    json={"questions": ["What is the maximum operating temperature of the ECU-850b?"]}
)
print(resp.json())
```

### 7.3 Postman

* POST ```http://localhost:8000/predict```
* Body (JSON)
```json
{
  "questions": ["What is the maximum operating temperature of the ECU-850b?"]
}
```

---

## 8. MLflow Model Logging

Log the model:
```bash
python -m me_engineering_assistant.log_model
```

MLflow will generate a run under:
```php-template
mlruns/0/<run_id>/
```

Set the model URI:
```bash
export MODEL_URI="runs:/<run_id>/me_engineering_assistant_model"
```

---

## 9. Running Tests

```bash
pytest -q
```

Expected:
```text
1 passed, 0 failed
```
The tests validate routing, retrieval, and answer correctness.

---

## 10. Docker Deployment (Optional)

Build:
```bash
docker build -t me-assistant .
```

Run:
```bash
docker run -p 8000:8000 -e MODEL_URI=$MODEL_URI me-assistant
```

---

## 11. Design Decisions

Why LangGraph?

* Deterministic routing

* Declarative workflow

* Better traceability vs. vanilla LangChain agents

Why Local LLM (Phi-3)?

* Reproducible

* Zero external API dependencies

* Fast on Apple Silicon (MPS + BF16)

Why MLflow?

* Model versioning

* Packaging reproducibility

* Standardized predict() interface

Chunking Strategy

* 500-char window with 50-char overlap

* Optimized for dense technical manuals

---

## 12. Limitations

| Limitation                             | Notes                                     |
| -------------------------------------- | ----------------------------------------- |
| Local LLM may hallucinate              | Mitigated by strict prompt + RAG context  |
| Router is rule-based                   | Could be upgraded to embedding classifier |
| Not optimized for very large documents | Current FAISS index fits small manuals    |
| No streaming responses                 | Could be added with FastAPI websockets    |

---

## 13. Future Work
